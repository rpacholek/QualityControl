<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>QualityControl: QuickStart</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">QualityControl
   &#160;<span id="projectnumber">0.13.0</span>
   </div>
   <div id="projectbrief">O2 Data Quality Control Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_doc_QuickStart.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">QuickStart </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a href="#quickstart">QuickStart</a><ul>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#setup">Setup</a><ul>
<li><a href="#environment-loading">Environment loading</a></li>
</ul>
</li>
<li><a href="#execution">Execution</a><ul>
<li><a href="#basic-workflow">Basic workflow</a></li>
<li><a href="#readout-chain">Readout chain</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>../README.md "↑ Go to the Table of Content ↑" | Continue to Modules Development →</p>
<h2>Requirements</h2>
<p>A Linux machine (CC7 or Ubuntu) or a Mac. See the O2 instructions below for the exact supported versions.</p>
<h2>Setup</h2>
<ol type="1">
<li>Install O2<ul>
<li>We use alibuild, see complete instructions <a href="https://alice-doc.github.io/alice-analysis-tutorial/building/">here</a>.</li>
</ul>
</li>
<li>Prepare the QualityControl development package<ul>
<li><code>aliBuild init QualityControl@master --defaults o2</code></li>
</ul>
</li>
<li>Install GLFW to have GUIs in the DPL (optional, DPL GUIs do not work in containers).<ul>
<li>On CC7 : <code>sudo yum install glfw-devel --enablerepo=epel</code></li>
<li>On Mac : <code>brew install glfw</code></li>
</ul>
</li>
<li><p class="startli">Build/install the QualityControl, its GUI (qcg) and the readout. The simplest is to use the metapackage <code>flpproto</code>.</p><ul>
<li><code>aliBuild build flpproto --defaults o2</code></li>
</ul>
<p class="startli">At this point you might encounter a message about missing system requirements. Run <code>aliDoctor flpproto</code> to get a full information about what is missing and how to install it.</p>
</li>
</ol>
<p>Note : you can also use the alibuild "defaults" called <code>o2-dataflow</code> to avoid building simulation related packages.</p>
<h3>Environment loading</h3>
<p>Whenever you want to work with O2 and QualityControl, do either <code>alienv enter flpproto/latest</code> or <code>alienv load flpproto/latest</code>.</p>
<h2>Execution</h2>
<p>To make sure that your system is correctly setup, we are going to run a basic QC workflow. We will use central services for the repository and the GUI. If you want to set them up on your computer or in your lab, please have a look <a href="#local-ccdb-setup">here</a> and <a href="#local-qcg-setup">here</a>.</p>
<h3>Basic workflow</h3>
<p>We will run a basic workflow described in the following schema.</p>
<div class="image">
<img src="images/basic-schema.png"  alt="alt text"/>
</div>
<p>The <em>Producer</em> is a random data generator. In a more realistic setup it would be a processing device or the <em>Readout</em>. The <em>Data Sampling</em> is the system in charge of dispatching data samples from the main data flow to the <em>QC tasks</em>. It can be configured to dispatch different proportion or different types of data. The <em>Checker</em> is in charge of evaluating the <em>MonitorObjects</em> produced by the <em>QC tasks</em>, for example by checking that the mean is above a certain limit. It can also modify the aspect of the histogram, e.g. by changing the background color or adding a PaveText. Finally the <em>Checker</em> is also in charge of storing the resulting <em>MonitorObject</em> into the repository where it will be accessible by the web GUI. It also pushes it to a <em>Printer</em> for the sake of this tutorial.</p>
<p>To run it simply do </p><pre class="fragment">o2-qc-run-basic
</pre><p>Thanks to the Data Processing Layer (DPL, more details later) it is a single process that steers all the <em>devices</em>, i.e. processes making up the workflow. A window should appear that shows a graphical representation of the workflow. The output of any of the processes is available by double clicking a box. If a box is red it means that the process has stopped, probably abnormaly.</p>
<div class="image">
<img src="images/basic-dpl-gui.png"  alt="alt text"/>
</div>
<p><b>Repository and GUI</b></p>
<p>The data is stored in the <a href="ccdb-test.cern.ch:8080/browse">ccdb-test</a> at CERN. If everything works fine you should see the objects being published in the QC web GUI (QCG) at this address : <a href="https://qcg-test.cern.ch/?page=objectTree">https://qcg-test.cern.ch/?page=objectTree</a>. The link brings you to the hierarchy of objects (see screenshot below). Open "QcTask" (the task you are running) and click on "example" which is the name of your histogram. The plot should be displayed on the right. If you wait a bit and hit "REFRESH NOW" in the far left menu you should see it changing from time to time (see second screenshot below). Please note that anyone running o2-qc-run-basic publishes the same object and you might see the one published by someone else.</p>
<div class="image">
<img src="images/basic-qcg1.png"  alt="alt text"/>
</div>
 <div class="image">
<img src="images/basic-qcg2.png"  alt="alt text"/>
</div>
<p>TODO add a link to the user documentation of the QCG</p>
<p><b>Configuration file</b></p>
<p>The devices are configured in the config file named <code>basic.json</code>. It is installed in <code>$QUALITYCONTROL_ROOT/etc</code>. Each time you rebuild the code, <code>$QUALITYCONTROL_ROOT/etc/basic.json</code> is overwritten by the file in the source directory (<code>~/alice/QualityControl/Framework/basic.json</code>).</p>
<h3>Readout chain</h3>
<p>In this second example, we are going to use the Readout as data source.</p>
<div class="image">
<img src="images/readout-schema.png"  alt="alt text"/>
</div>
<p>This workflow is a bit different from the basic one. The <em>Readout</em> is not a device and thus we have to have a <em>proxy</em> to get data from it. This is the extra box going to the dispatcher, which then injects data to the task. This is handled in the <em>Readout</em> if you enable the corresponding configuration flag.</p>
<p>TODO make the qc task use the daq code</p>
<p>To do so, open the readout config file located at <code>$READOUT_ROOT/etc/readout.cfg</code> and make sure that the following properties are correct :</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# First make sure we never exit</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;[readout]</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;(...)</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;exitTimeout=-1</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;(...)</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;# And enable the data sampling</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;[consumer-data-sampling]</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;consumerType=DataSampling</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;enabled=1</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;(...)</div></div><!-- fragment --><p>Start Readout : </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;readout.exe file://$READOUT_ROOT/etc/readout.cfg</div></div><!-- fragment --><p>Start the QC and DS (DataSampling) workflow : </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;o2-qc-run-readout</div></div><!-- fragment --><p>The data sampling is configured to sample 1% of the data as the readout should run by default at full speed.</p>
<h4>Readout data received by the Task</h4>
<p>The header is a O2 header populated with data from the header built by the Readout. The payload received is a 2MB (configurable) data page made of CRU pages (8kB).</p>
<p><b>Configuration file</b></p>
<p>The configuration file is installed in <code>$QUALITYCONTROL_ROOT/etc</code>. Each time you rebuild the code, <code>$QUALITYCONTROL_ROOT/etc/readout.json</code> is overwritten by the file in the source directory (<code>~/alice/QualityControl/Framework/readout.json</code>). To avoid this behaviour and preserve the changes you do to the configuration, you can copy the file and specify the path to it with the parameter <code>--config-path</code> when launch <code>o2-qc-run-readout</code>.</p>
<p>To change the fraction of the data being monitored, change the option <code>fraction</code>.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&quot;fraction&quot;: &quot;0.01&quot;,</div></div><!-- fragment --> <hr/>
<p>../README.md "↑ Go to the Table of Content ↑" | Continue to Modules Development → </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
